id: RIS-TASK-GOV-104-WORKER-SIMULATION
title: Implement Worker Pipeline Simulation
type: testing
status: completed
priority: high
created: 2025-11-28
completed: 2025-11-28
bundle: "10"
version: "1.8.3"
parent_task: RIS-TASK-GOV-100-TESTING-ENGINE

objective: |
  Implement comprehensive worker pipeline testing including async task
  execution, retry logic, error handling, and pipeline orchestration.

scope:
  - Document processing pipeline tests
  - Compliance check pipeline tests
  - Retry logic tests (transient vs. permanent failures)
  - Task orchestration tests (chaining, parallelization)
  - Worker pipeline test matrix documentation
  - Lane test runner for worker lane

deliverables:
  - "✓ governance/testing/worker_pipeline_tests.md"
  - "✓ governance/lanes/worker/tests_runner.md"
  - "✓ tests/config/simulation_matrix.json (worker_simulations section)"

test_scenarios:
  document_processing:
    - Happy path: Valid PDF → UPLOADED → PROCESSING → COMPLETED
    - Extraction failure: Bedrock error (transient) → retry 3x → COMPLETED
    - Permanent failure: Invalid format → UPLOADED → PROCESSING → FAILED
    - Large document: 10MB PDF → complete within timeout
    - Concurrent uploads: 5 simultaneous → all succeed
    - Duplicate upload: Same document twice → second skipped

  compliance_check:
    - Happy path: Compliant provider → PENDING → RUNNING → COMPLETED (PASS)
    - Non-compliant: Missing licenses → PENDING → RUNNING → COMPLETED (FAIL)
    - Missing data: Provider not found → PENDING → FAILED
    - Timeout: Evaluation > 60s → PENDING → RUNNING → TIMEOUT → retry
    - Chain failure: Report generation fails → PENDING → RUNNING → FAILED

retry_logic_tests:
  - RL-001: Transient failure retry (3 attempts, exponential backoff)
  - RL-002: Permanent failure no retry (400, 422)
  - RL-003: Max retry limit (stop at 3)
  - RL-004: Retry state persistence (survives worker restart)

pipeline_orchestration_tests:
  - PO-001: Task chaining (correct order)
  - PO-002: Parallel execution (independent tasks)
  - PO-003: Resource limits (max concurrency)
  - PO-004: Task timeout (at configured threshold)

error_handling_tests:
  - EH-001: Graceful degradation (one failure doesn't block others)
  - EH-002: Error notification (failures trigger alerts)
  - EH-003: Dead letter queue (permanently failed tasks move to DLQ)

golden_pipeline_tests:
  - DOC-PIPELINE-001: Upload → extract → validate → store
  - COMP-PIPELINE-001: Check → report → notify
  - RETRY-PIPELINE-001: Transient failure → retry → succeed on 2nd attempt

performance_benchmarks:
  - Single document processing: < 30 seconds
  - Concurrent (5 docs): < 60 seconds total
  - Single compliance check: < 60 seconds
  - Batch (10 providers): < 300 seconds total

enforcement:
  - T2 level (merge-blocking)
  - Run on every PR touching worker code
  - Monthly performance review
  - Failures create RIS-INC

references:
  - governance/testing/worker_pipeline_tests.md
  - governance/lanes/worker/tests_runner.md
  - apps/worker-tasks/src/
