---
ris_id: RIS-TASK-GOV-023
type: task
status: in_progress
priority: high
lane: governance
created: 2025-12-02T23:15:00Z
updated: 2025-12-03T07:08:21Z
github_issue: 23

title: "/start command permission system not honoring pre-approved patterns"

problem: |
  The `/start` command requests user approval for Write operations
  (`Write(sessions/*/*)` and `Write(.claude/.session_active)`) despite
  these patterns being explicitly listed in `.claude/settings.local.json`
  under `permissions.allow` with `defaultMode: "dontAsk"`.

  This breaks zero-prompt automation workflow and creates approval fatigue
  (the exact problem Phase 7 governance simplification tried to eliminate).

impact:
  user_experience: high
  developer_velocity: medium
  system_integrity: none
  security: none

root_cause_theories:
  - theory: "PostToolUse hooks (track-activity.ps1, ris-detector.ps1) intercept Write operations"
    evidence: "Hooks run after every tool use, may trigger permission re-evaluation"
    confidence: medium

  - theory: "Windows absolute paths don't match glob patterns"
    evidence: "Actual path `c:\\CREDMATE\\sessions\\20251202\\...` vs pattern `sessions/*/*`"
    confidence: high

  - theory: "Permission settings not loaded at tool execution time"
    evidence: "Race condition or lazy loading of settings.local.json"
    confidence: low

proposed_solutions:
  - id: bash-only-workaround
    name: "Rewrite /start and /close to use PowerShell via Bash tool"
    effort_hours: 1
    risk: low
    pros:
      - "Immediate fix"
      - "Bash commands are pre-approved and working"
      - "No permission debugging needed"
    cons:
      - "Workaround, not root cause fix"
      - "Less elegant than native Write tool"
    status: recommended

  - id: permission-pattern-refinement
    name: "Test different permission patterns in settings.local.json"
    effort_hours: 2-4
    risk: medium
    pros:
      - "Fixes root cause"
      - "Benefits all pre-approved Write operations"
      - "Better long-term solution"
    cons:
      - "Requires trial-and-error testing"
      - "May expose Claude Code bug (unfixable by us)"
    status: backlog

  - id: hook-isolation-test
    name: "Temporarily disable PostToolUse hooks to test if they're causing interference"
    effort_hours: 0.5
    risk: low
    pros:
      - "Identifies if hooks are the culprit"
      - "Low effort, high information value"
      - "Reversible change"
    cons:
      - "Temporarily breaks activity tracking"
      - "Doesn't provide immediate fix"
    status: next_step

recommended_path:
  - step: 1
    action: "Hook Isolation Test (30 min)"
    details: "Comment out PostToolUse hooks, test /start, document results"

  - step: 2
    action: "Implement Bash-Only Workaround (1 hour)"
    details: "Rewrite /start and /close commands, update documentation"

  - step: 3
    action: "Root Cause Fix (backlog)"
    details: "Debug permission pattern matching, report to Claude Code team if bug"

evidence:
  config_verification:
    file: ".claude/settings.local.json"
    line_22: 'Write(sessions/*/*)'
    line_23: 'Write(.claude/.session_active)'
    line_67: 'defaultMode: "dontAsk"'

  behavior_observed:
    command: "/start testing the '/start command"
    blocked_operations:
      - "Write(sessions/20251202/SESSION-20251202-2315-start-command-test.md)"
      - "Read(.claude/.session_active)"
    result: "Approval prompts displayed, workflow blocked"

  close_command_test:
    command: "/close"
    result: "No active session to close"
    confirms: "Session was never created due to blocked Write operations"

related:
  phase: "Phase 7: Governance Simplification (2025-12-02)"
  github_issue: "https://github.com/SerenityMavens/credmate/issues/23"
  documentation: ".claude/commands/start.md"
  config: ".claude/settings.local.json"

continuity_notes: |
  - Session automation is core to governance model
  - Approval fatigue was eliminated in Phase 7 (2025-12-02)
  - This bug undermines Phase 7 goals
  - Quick fix acceptable, root cause can wait
  - Next session should start with Hook Isolation Test

files_involved:
  - ".claude/settings.local.json"
  - ".claude/commands/start.md"
  - ".claude/commands/close.md"
  - ".claude/hooks/scripts/track-activity.ps1"
  - ".claude/hooks/scripts/ris-detector.ps1"

session_reference: "sessions/20251202/SESSION-20251202-2315-start-command-investigation.md"

agent_notes: |
  This RIS demonstrates meta-problem: governance automation system has bug.
  The investigation session itself couldn't use automated session management
  because the automation is broken. Ironic but valuable debugging exercise.

tags:
  - governance
  - automation
  - permissions
  - claude-code
  - hooks
  - approval-fatigue
  - phase-7
