id: RIS-TASK-GOV-102-SCHEMA-TESTS
title: Implement Schema & API Contract Tests
type: testing
status: completed
priority: high
created: 2025-11-28
completed: 2025-11-28
bundle: "10"
version: "1.8.3"
parent_task: RIS-TASK-GOV-100-TESTING-ENGINE

objective: |
  Implement comprehensive schema validation and API contract testing to
  ensure database schema integrity and API specification compliance.

scope:
  - Database schema validation (migrations, constraints, indexes)
  - API contract validation (request/response schemas, status codes)
  - Schema test rules documentation
  - API contract test documentation
  - Validation tools implementation

deliverables:
  - "✓ governance/testing/schema_test_rules.md"
  - "✓ governance/testing/api_contract_tests.md"
  - "✓ tests/tools/schema_validator.py"
  - "✓ tests/tools/api_contract_validator.py"
  - "✓ tests/tools/migration_validator.py"

test_rules:
  schema_validation:
    - SR-001: Migration reversibility (up/down)
    - SR-002: Foreign key integrity
    - SR-003: Unique constraint validation
    - SR-004: API request validation
    - SR-005: API response validation
    - SR-006: Enum consistency
    - SR-007: Required field enforcement
    - SR-008: Default value correctness
    - SR-009: Index presence
    - SR-010: Migration idempotency

  api_contract:
    - AC-001: Request schema validation
    - AC-002: Response schema validation
    - AC-003: HTTP status code correctness
    - AC-004: Error response format
    - AC-005: Pagination consistency
    - AC-006: Idempotency (PUT/DELETE)
    - AC-007: Authentication enforcement
    - AC-008: Authorization enforcement
    - AC-009: CORS headers
    - AC-010: Content negotiation

validation_tools:
  schema_validator:
    purpose: "Validate JSON schemas and Pydantic models"
    methods: ["validate_data", "validate_file", "validate_pydantic_schema"]

  api_contract_validator:
    purpose: "Validate API contracts and responses"
    methods: ["validate_request_schema", "validate_response_schema", "validate_idempotency"]

  migration_validator:
    purpose: "Validate database migrations"
    methods: ["validate_migration_reversibility", "validate_migration_syntax", "check_dependencies"]

enforcement:
  - T1 level (merge-blocking)
  - Run on every PR touching models, schemas, or migrations
  - Integrated into pr-validate.yml workflow
  - Blocking failures create RIS-INC

references:
  - governance/testing/schema_test_rules.md
  - governance/testing/api_contract_tests.md
  - tests/tools/__init__.py
