---
resolution_id: RIS-RESOLUTION-044
title: Governance Test Suite False Negatives and Permission Cleanup
status: resolved
priority: high
date_created: 2025-12-11
category: bug
lane: infra

problem:
  description: |
    Governance test suite showing 50% false negative rate (2/4 tests failing).
    Test 1 (validate_env_preflight.py) and Test 2 (strict-block-formatter) were failing due to file naming and Windows encoding issues.
    Bash permissions had grown to 113 total (77 patterns, 22 specific), exceeding RIS-043 thresholds (<70 total, <50 patterns, <5 specific).
  root_cause: |
    1. Python module named with hyphens (strict-block-formatter.py) couldn't be imported with underscores (strict_block_formatter)
    2. Windows console (cp1252 encoding) couldn't handle Unicode emojis in health_check() output
    3. Test script used jq (not available on Windows) and wrong settings path
    4. Permission accumulation over time without periodic cleanup

solution:
  approach: |
    Fixed test infrastructure bugs and reduced permissions by 48% (113 â†’ 59).
    Renamed file for Python import compatibility, added UTF-8 encoding wrapper for Windows,
    replaced jq with Python, and cleaned up one-time/redundant permissions.
  files_changed:
    - .claude/hooks/scripts/strict_block_formatter.py: Renamed from strict-block-formatter.py (Python import fix)
    - infra/scripts/validate_env_preflight.py: Added UTF-8 encoding wrapper for Windows (L93-98)
    - infra/scripts/test_governance_controls.sh: Replaced jq with Python one-liner (L142), updated file references (L176)
    - .claude/settings.local.json: Removed 54 permissions (one-time commits, file ops, rarely-used patterns)
    - infra/scripts/load_test_baseline.py: Created Python-based load tester (cross-platform alternative to Apache Bench)
    - docs/governance-metrics-log.md: Added load test baseline entry

validation:
  method: |
    Ran full test suite: bash infra/scripts/test_governance_controls.sh
    Verified permission counts with Python audit script
    Executed load test baseline
  result: |
    PASS - All 4 tests passing (1190ms runtime, 13% faster)
    PASS - Permissions: 59 total (42 patterns, 0 specific), all thresholds met
    PASS - Load test: 10/10 health, 5/5 docs, ~0.2s response time

lessons_learned:
  - Always use Python-importable names (underscores, not hyphens) for Python modules
  - Add UTF-8 encoding wrappers for Windows compatibility when using emojis/Unicode
  - Prefer Python over jq for cross-platform scripts (jq not available on Windows Git Bash)
  - Periodic permission audits prevent accumulation (recommend weekly/monthly review)
  - Pattern philosophy: Skills > Patterns > Specific commands (minimize specific for maintainability)

metrics:
  test_suite_pass_rate:
    before: 50%
    after: 100%
  test_suite_runtime:
    before: 1365ms
    after: 1190ms
    improvement: 13%
  permissions:
    before:
      total: 113
      patterns: 77
      specific: 22
    after:
      total: 59
      patterns: 42
      specific: 0
    reduction: 48%

tags: [testing, governance, permissions, windows, cross-platform, false-negatives]

related:
  session: SESSION-20251211-1120-governance-hardening-continuation
  ris: RIS-043
  commit: 4b73fb4
---
