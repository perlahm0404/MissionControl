task_id: RIS-TASK-INFRA-PROD-003
title: "Production Docker Compose Update - Worker + Redis + API URL"
status: completed
severity: HIGH
lane: infra
created: 2025-11-28
completed: 2025-11-28
session: RIS-SESSION-20251128-2345-governance-remediation-v1

description: |
  Production docker-compose.prod.yml updated to include:
  - Redis service for Celery broker (with health checks)
  - Worker service for async document processing
  - Updated NEXT_PUBLIC_API_URL to /api (relative path for NGINX proxy)
  - Updated S3 bucket env var naming (S3_DOCUMENTS_BUCKET)
  - Redis password support for authenticated connections

files_modified:
  - docker-compose.prod.yml
  - .github/workflows/docker-build.yml
  - apps/worker-tasks/Dockerfile
  - apps/frontend-web/Dockerfile

change_plan:
  - Add Redis service with health checks and persistence
  - Add worker service configuration with Bedrock enabled
  - Update frontend NEXT_PUBLIC_API_URL from https://api.${DOMAIN_NAME} to /api
  - Update S3 env var names to match config.py (S3_DOCUMENTS_BUCKET)
  - Add Redis password support in worker celery_app.py

rollback_plan:
  - git checkout HEAD~1 -- docker-compose.prod.yml
  - git checkout HEAD~1 -- .github/workflows/docker-build.yml
  - git checkout HEAD~1 -- apps/worker-tasks/Dockerfile
  - git checkout HEAD~1 -- apps/frontend-web/Dockerfile
  - Redeploy without worker/Redis (document processing unavailable)

impact:
  - Enables async document processing in production
  - Enables worker-based Celery tasks
  - Fixes frontend API routing via NGINX proxy
  - Fixes S3 bucket configuration alignment

testing:
  - Local docker-compose build verification
  - CI pipeline test (GitHub Actions)
  - Production deployment verification

approver: "Human (retroactive approval via EXECUTION-GATE)"
approval_timestamp: "2025-11-28T23:50:00Z"
governance_session: "GOVERNANCE-REMEDIATION-V1"

tags:
  - infra
  - docker
  - production
  - worker
  - redis
  - celery
