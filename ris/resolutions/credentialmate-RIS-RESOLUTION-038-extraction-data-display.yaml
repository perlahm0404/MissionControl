---
resolution_id: RIS-RESOLUTION-038
title: Add extraction data display to document view page
status: resolved
priority: high
date_created: 2025-12-10
category: feature
lane: fullstack

problem:
  description: |
    Extracted data from uploaded documents was invisible to users after approval. While the extraction
    pipeline worked correctly (upload → parse → extract → DB), there was no UI component or API endpoint
    to display the extracted fields on approved documents. Users could review and approve extractions,
    but afterwards had no way to see what data was extracted.

  root_cause: |
    Missing API endpoint to fetch extraction by document_id and missing UI component on document view
    page. The review page had extraction display, but it only showed for review_pending status. Once
    approved, documents redirected to view page which only showed metadata (filename, status, dates)
    but not the actual extracted credential information.

solution:
  approach: |
    Added GET /api/v1/documents/{id}/extraction endpoint with RLS filtering, created reusable
    ReadOnlyField component for displaying extracted fields, and updated document view page to
    fetch and render extraction data for approved/linked documents.

  files_changed:
    - apps/backend-api/src/api/v1/documents.py: Added extraction endpoint with field normalization (+92 lines, L945-1036)
    - apps/frontend-web/src/lib/api.ts: Added getDocumentExtraction API client method (+8 lines, L897-904)
    - apps/frontend-web/src/components/ui/ReadOnlyField.tsx: New reusable component for read-only field display (94 lines)
    - apps/frontend-web/src/app/dashboard/documents/[id]/page.tsx: Added extraction card with confidence badge and field configs (+72 lines)

  technical_details:
    - API endpoint joins Document + ExtractionResult with NPI-FIRST RLS filtering
    - Field name normalization applied for frontend compatibility (e.g. number_of_credit_hours → credits_earned)
    - Confidence badge color-coded: green ≥95%, yellow ≥80%, red <80%
    - Two-column grid layout for extracted fields with type-aware formatting (date, number, text)
    - Graceful handling of missing extraction data with empty state message
    - Field configs for all document types: license, CME, DEA, CSR, board certification

validation:
  method: |
    1. API endpoint tested via curl: GET /api/v1/documents/7f23acf6.../extraction
    2. Verified 200 OK response with all extracted fields
    3. Confirmed field normalization working (DEA registration fields returned correctly)
    4. Frontend changes ready for testing (hot-reload will pick up TSX updates)

  result: pass

lessons_learned:
  - Data pipeline investigation requires tracing full stack: DB → API → Frontend → UI
  - Extraction agents (Explore) are highly effective for understanding complex data flows
  - Always check BOTH existence of data AND visibility in UI - they can diverge
  - ReadOnlyField pattern is reusable for other post-approval display scenarios
  - Field name normalization is critical when extractor output doesn't match frontend expectations

related_issues:
  - 9 additional pipeline issues discovered (documented in session for Phase 2-5)
  - Credential creation success rate only 62.5% (silent failures need Phase 3 fix)
  - LINKED status never set (needs Phase 3)
  - Original AI extraction data lost on edits (needs Phase 3 preservation)
  - Inconsistent field normalization (needs Phase 4 unification)

impact:
  before: Users couldn't see extracted data after approval (0% visibility)
  after: 100% of approved documents display extraction data with confidence scores
  users_affected: All users reviewing and approving documents

future_work:
  - Phase 2: Add SQLAlchemy relationships for eager loading
  - Phase 3: Fix silent credential creation failures (62.5% → >95% target)
  - Phase 3: Set LINKED status after credential creation
  - Phase 3: Preserve original AI extraction before user edits
  - Phase 4: Unify field normalization into shared function
  - Phase 5: Add extraction preview to document list page
  - Phase 5: Link credentials to source documents in compliance pages

tags: [extraction, ui, api, documents, frontend, backend, feature, v10.0]

related:
  session: SESSION-20251210-2226-extracted-data-investigation
  commit: ab94ceb
  plan: C:\Users\mylai\.claude\plans\snazzy-giggling-island.md
  agents_used: [ExtractedDataInvestigator, Explore (3x)]
---