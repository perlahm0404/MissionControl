# RIS-067: CME Topic Progress Display in Smart Recommendations

resolution_id: RIS-067
title: "CME Topic Progress Display in Smart Recommendations"
date_created: 2025-12-03
date_resolved: 2025-12-03
category: ui
priority: P2
status: partial

## Problem Statement

The Smart Recommendations tab shows topics that are NEEDED but doesn't show what the provider has already COMPLETED. Users can't see their progress toward topic requirements.

**Impact**:
- Users don't know how much they've already earned for each topic
- No visibility into partial progress
- Harder to prioritize which topics to focus on

## Root Cause

The `HarmonizerCourseRecommendation` schema only returned `recommended_hours` (the gap/needed hours) but not `earned_hours` (what's already completed). The harmonizer endpoint calculated `topic_credits` internally but didn't expose it in the API response.

## Solution

### 1. Backend Schema Update

**File**: `apps/backend-api/src/contexts/cme/schemas/cme_schemas.py:316`

```python
class HarmonizerCourseRecommendation(BaseModel):
    topic: str
    topic_display_name: str
    recommended_hours: float  # Max hours needed (gap)
    earned_hours: float = 0.0  # Hours already completed for this topic  # ADDED
    states_satisfied: List[str]
    efficiency_score: float
    priority: str
    description: str
```

### 2. Backend Endpoint Update

**File**: `apps/backend-api/src/contexts/cme/api/compliance_endpoints.py:558-568`

```python
for item in topics_by_state_count[:request.max_recommendations]:
    topic = item["topic"]
    states_list = item["states_satisfied"]
    earned = topic_credits.get(topic, 0)  # Get earned hours from existing dict

    recommendations.append(HarmonizerCourseRecommendation(
        topic=topic,
        topic_display_name=topic.replace("_", " ").title(),
        recommended_hours=round(item["recommended_hours"], 1),
        earned_hours=round(earned, 1),  # Include in response
        ...
    ))
```

### 3. Frontend Interface Update

**File**: `apps/frontend-web/src/app/dashboard/cme/page.tsx:42`

```typescript
interface HarmonizerRecommendation {
  topic: string;
  topic_display_name: string;
  recommended_hours: number;
  earned_hours: number;  // ADDED
  states_satisfied: string[];
  efficiency_score: number;
  priority: string;
  description: string;
}
```

### 4. Frontend Table Headers Update

**File**: `apps/frontend-web/src/app/dashboard/cme/page.tsx:584-585`

Updated table headers from "Max Hrs" to "Earned" and "Needed" columns.

## Files Modified

- `apps/backend-api/src/contexts/cme/schemas/cme_schemas.py:316` - Added earned_hours field
- `apps/backend-api/src/contexts/cme/api/compliance_endpoints.py:558-568` - Return earned hours
- `apps/frontend-web/src/app/dashboard/cme/page.tsx:42,584-585` - Interface + table headers

## Validation

**Backend**: ✅ Complete - API returns earned_hours
**Frontend Headers**: ✅ Complete - Shows "Earned" and "Needed" columns
**Frontend Table Body**: ❌ Pending - Need to add cell displaying rec.earned_hours

## Next Steps

Add earned hours cell to table body rows (after Priority cell):

```tsx
<td className="px-4 py-3 text-center">
  <span className={`font-semibold ${rec.earned_hours > 0 ? 'text-safe-600' : 'text-text-tertiary'}`}>
    {rec.earned_hours}
  </span>
  <span className="text-text-tertiary text-sm"> hrs</span>
</td>
```

## Related

- GitHub Issues: #70 (DEA onboarding), #71 (infection control), #72 (DEA filter)
- Previous fix: RIS-RESOLUTION-027 (CME Architecture V2)
- Session: SESSION-20251203-2100-cme-equivalent-fix.md

## Tags

cme, harmonizer, ui, topic-progress, frontend
