---
resolution_id: RIS-RESOLUTION-036
title: Backend Persistence for Credential Renewal Intents
status: resolved
priority: medium
date_created: 2025-12-09
date_resolved: 2025-12-09
category: feature
lane: backend

problem:
  description: |
    Renewal intents on the /dashboard/renewals page were stored only in client-side
    React state. When users refreshed the page, their selections were lost.
  root_cause: |
    No backend persistence layer existed for the renewal intent field.

solution:
  approach: Add renewal_intent column to credential tables with API endpoints
  files_changed:
    - alembic/versions/20251209_2100_add_renewal_intent_to_credentials.py: Migration for 3 tables
    - contexts/provider/models/license.py: Added renewal_intent column
    - contexts/provider/models/dea_registration.py: Added renewal_intent column
    - contexts/provider/models/csr.py: Added renewal_intent column
    - contexts/provider/api/license_endpoints.py: PATCH endpoint
    - contexts/provider/api/dea_endpoints.py: PATCH endpoint
    - contexts/provider/api/csr_endpoints.py: PATCH endpoint
    - apps/frontend-web/src/app/dashboard/renewals/page.tsx: API integration
  code_pattern: |
    # PATCH endpoint pattern
    @router.patch("/{id}/renewal-intent")
    def update_renewal_intent(
        id: int,
        request: RenewalIntentUpdateRequest,
        db: Session = Depends(get_db),
        current_user: User = Depends(get_current_user)
    ):
        license.renewal_intent = request.renewal_intent
        db.commit()
        return RenewalIntentResponse.model_validate(license)

validation:
  method: Playwright E2E test + curl API verification
  result: pass

lessons_learned:
  - VARCHAR(20) preferred over ENUM for flexibility
  - Include field in summary endpoints, not just dedicated endpoints
  - Frontend should refresh data after PATCH, not update local state

tags:
  - renewal-intent
  - dashboard
  - persistence
  - credentials

related:
  session: SESSION-20251209-2045-dashboard-ux-verification
---
