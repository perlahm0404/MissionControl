---
resolution_id: RIS-RESOLUTION-002
title: Duplicate Enum Definitions Causing Runtime Mismatch Errors
status: resolved
priority: critical
date_created: 2025-12-08
date_resolved: 2025-12-08
category: bug
lane: all

problem:
  description: |
    Recurring runtime errors caused by duplicate enum definitions with conflicting values.
    Two files defined DocumentType and DocumentStatus enums with different values:
    - apps/shared/enums/document.py (canonical): LICENSE, CSR, scan_clean, review_pending
    - apps/backend-api/src/shared/domain/enums.py (deprecated): MEDICAL_LICENSE, CONTROLLED_SUBSTANCE_REGISTRATION, virus_scan_clean, review_required
  root_cause: |
    Phase 4 structural refactor created duplicate enum file instead of importing from canonical location.
    Different code paths imported from different sources, causing value mismatches.

solution:
  approach: Delete deprecated enum, create prevention system with CI validation
  files_changed:
    - apps/backend-api/src/shared/domain/enums.py: DELETED
    - apps/backend-api/tests/unit/documents/test_extractionresult_fk.py: Fixed import
    - apps/backend-api/src/contexts/provider/models/csr.py: Use enum instead of hardcoded string
    - apps/shared/contracts/types.json: CREATED - Single source of truth
    - infra/scripts/validate-api-contracts.py: CREATED - CI validation
    - apps/frontend-web/src/types/credentials.ts: CREATED - Frontend type safety
  code_pattern: |
    # Import from canonical location ONLY
    from apps.shared.enums.document import DocumentType, DocumentStatus

    # Never create duplicate enum definitions
    # Use apps/shared/contracts/types.json as reference

validation:
  method: Manual verification - imports fixed, deprecated file deleted
  result: pass

lessons_learned:
  - Single source of truth for enums prevents drift
  - CI validation catches duplicates before merge
  - Frontend types should be generated from backend enums

tags:
  - enums
  - type-safety
  - ci-validation
  - duplicate-detection

related:
  session: SESSION-20251208-2530-labeling-mismatch-audit
---
