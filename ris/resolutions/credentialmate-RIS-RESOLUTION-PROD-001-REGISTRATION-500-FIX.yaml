---
resolution_id: RIS-RESOLUTION-PROD-001
title: Production Registration 500 Error - Missing Migrations
status: resolved
priority: critical
date_created: 2025-12-08
date_resolved: 2025-12-08
category: bug
lane: backend

problem:
  description: |
    Production registration endpoint (/api/v1/auth/register) returning HTTP 500.
    Users unable to sign up on credentialmate.com.
  root_cause: |
    Production database was 9 migrations behind. Provider model references
    npi_set_at, npi_correction_count, npi_correction_history columns added in
    migration 20251207_1800, but production was at 20251127_1410.

solution:
  approach: Applied 9 missing migrations to production RDS
  files_changed:
    - alembic_version: upgraded from 20251127_1410 to 20251208_0900
  code_pattern: |
    docker exec -e DATABASE_URL="postgresql://user:pass@host:5432/db" \
      -w /app/apps/backend-api credmate-backend-prod alembic upgrade head

validation:
  method: curl test to registration and login endpoints
  result: pass

lessons_learned:
  - Deploy workflow should include automatic migration step
  - Need skill to compare local vs prod migration versions
  - alembic env.py requires DATABASE_URL env var, not individual vars

tags:
  - production
  - migrations
  - registration
  - critical-fix

related:
  session: SESSION-20251208-2130-prod-login-investigation
---
